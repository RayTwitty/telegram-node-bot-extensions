# telegram-node-bot-extensions
Этот небольшой проект представляет собой расширения стандартного функционала для библиотеки [telegram-node-bot](https://github.com/Naltox/telegram-node-bot).
## Начало работы
Для того, чтобы начать пользоваться расширениями, достаточно вызвать следующий код после объявления констант **telegram-node-bot**:
```js
require('./extensions')(Telegram, tg)
```
## Multi Forms
Вы можете создавать сложные формы с высокой степенью вложенности. Используйте `$.runMultiForm` для запуска.
```js
const form = {
	category: {
		title: 'Выбери категорию',
		error: 'Ты неправильно ввел категорию!',
		keyboard: [['Курьер', 'Ремонт']],
		'Курьер': {
			subcategory: {
				title: 'Выбери подкатегорию',
				error: 'Ты неправильно ввел подкатегорию!',
				keyboard: [['Пеший курьер', 'Доставка продуктов']]
			},
			size: {
				title: 'Установить размер посылки?',
				keyboard: [['Да', 'Нет']],
				values: {'Да': true, 'Нет': false},
				'Да': {
					length: {
						title: 'Задай длину посылки (см)',
						validator: (message) => {
							return Number.isInteger(parseInt(message.text))
						}
					},
					width: {
						title: 'Задай ширину посылки (см)',
						validator: (message) => {
							return Number.isInteger(parseInt(message.text))
						}
					}
				}
			},
			weight: {
				title: 'Задай вес посылки',
				validator: (message) => {
					return Number.isInteger(parseInt(message.text))
				}
			}
		},
		'Ремонт': {
			subcategory: {
				title: 'Выбери подкатегорию',
				keyboard: [['Ремонт мебели', 'Отделочные работы']]
			}
		}
	},
	contacts: {
		title: 'Оставить контакты?',
		keyboard: [['Да', 'Нет']]
	}
}

const config = {
	buttons: {
		cancel: 'Отменить',
		back: 'Назад'
	},
	messages: {
		canceled: 'Заполнение формы отменено.',
		completed: 'Форма успешно заполнена.'
	}
}

$.runMultiForm(form, result => {
	console.log(result)
}, config)
```
### Структура формы
Каждая форма состоит из вопросов, на которые должен ответить пользователь. Каждый вопрос должен включать в себя текст вопроса и ответ на него. В качестве проверки ответа выступает функция-валидатор либо текст из кнопок клавиатуры. Если указано и то и другое, функция-валидатор будет иметь приоритет.
```js
...
	validator: (message) => {
		return Number.isInteger(parseInt(message.text))
	}
...
```
В случае, если ответ не прошел проверку, может быть выведено сообщение об ошибке, которое устанавливается полем `error`.
```js
...
	title: 'Выбери подкатегорию',
	error: 'Ты неправильно ввел подкатегорию!',
...
```
При каждом правильном ответе на вопрос производится поиск дочерней формы, объект которой называется именем этого ответа.
```js
...
	title: 'Выбери категорию',
	error: 'Ты неправильно ввел категорию!',
	keyboard: [['Курьер', 'Ремонт']],
	'Курьер': {...},
	'Ремонт': {...}
...
```
Есть возможность переопределения значений, которые будут записаны в результат. Для этого служит поле `values`.
```js
...
	title: 'Установить размер посылки?',
	keyboard: [['Да', 'Нет']],
	values: {'Да': true, 'Нет': false},
...
```
### Настройка формы
Доступна установка дополнительных параметров формы через конфиг, который можно передать в конструктор.
```js
const config = {
	buttons: {
		cancel: 'Отменить',
		back: 'Назад'
	},
	messages: {
		canceled: 'Заполнение формы отменено.',
		completed: 'Форма успешно заполнена.'
	}
}
```
В объекте `buttons` задается использование кнопок. Можно включить кнопки отмены и возвращения к предыдущему вопросу. Аналогичным образом, в объекте `messages` можно включить сообщения при завершении и при отмене формы.

Важно отметить, что конфиг совершенно опционален. Все функции, которыми он управляет по умолчанию выключены. Поэтому, если вы не хотите, допустим, использовать кнопку "Назад", просто не указываете ее в конфиге.
